name: Build macOS ARM64

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # Allow manual trigger

jobs:
  build-macos-arm64:
    runs-on: macos-14  # Apple Silicon runner
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Download dependencies
      run: bash scripts/vendor.sh
    
    - name: Build extension
      run: make
    
    - name: Verify build
      run: |
        ls -lh build/libgraph.dylib
        file build/libgraph.dylib
    
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: sqlite-graph-macos-arm64
        path: build/libgraph.dylib
